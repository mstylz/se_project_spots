(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(t=r.currentScript.src),!t)){var n=r.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=n[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t={inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn-disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};function r(e,t,r){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),n&&(n.textContent="",n.style.display="none")}function n(e,t,r){const n=e.some(e=>!e.validity.valid);t.disabled=n,t.classList.toggle(r.inactiveButtonClass,n)}function o(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),l=e.querySelector(t.submitButtonSelector);o.forEach(n=>r(e,n,t)),n(o,l,t)}const l=e.p+"assets/2fc47fd8e9a9bcd9612f.jpg";function i(e,t){if(!e)return;const r=new Image;r.onload=()=>{e.src=t},r.onerror=()=>{console.warn("Image URL failed to load, using fallback:",t),e.src=l},t&&"string"==typeof t&&t.startsWith("http")?r.src=t:e.src=l}function a(e,t,r="Save",n="Saving..."){t.textContent=e?n:r}function s(e,t,r="Saving..."){t.preventDefault();const n=t.submitter,o=n.textContent;a(!0,n,o,r),e().then(()=>{t.target.reset()}).catch(console.error).finally(()=>{a(!1,n,o)})}const c=e.p+"assets/d3610e9c6dce3cb370d8.svg",d=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_check(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){const r={headers:this._headers,...t},n=`${this._baseUrl}${e}`;return fetch(n,r).then(this._check)}getUser(){return this._request("/users/me")}getCards(){return this._request("/cards")}getAppData(){return Promise.all([this.getUser(),this.getCards()])}updateUser({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}updateAvatar(e){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}addCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}likeCard(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}unlikeCard(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"b5bb21ca-524c-4b9b-82e8-ef9e8c025693","Content-Type":"application/json"}}),u=document.querySelector(".header__logo"),m=document.querySelector(".profile__name"),_=document.querySelector(".profile__description"),p=document.querySelector(".profile__avatar");u&&(u.src=c),p&&(p.src=l);const v=document.querySelector(".cards__list"),y=document.querySelector("#card-template"),f=document.querySelector("#edit-profile-modal"),S=document.querySelector("#new-post-modal"),h=document.querySelector("#delete-modal"),b=document.querySelector("#avatar-modal"),q=document.querySelector("#preview-modal"),k=f?f.querySelector(".modal__close-btn"):null,g=S?S.querySelector(".modal__close-btn"):null,C=h?h.querySelector(".modal__close-btn"):null,E=b?b.querySelector(".modal__close-btn"):null,L=q?q.querySelector(".modal__close-btn"):null,w=f?f.querySelector(".modal__form"):null,x=S?S.querySelector(".modal__form"):null,A=h?h.querySelector(".modal__form"):null,T=b?b.querySelector(".modal__form"):null,U=w?w.querySelector("#profile-name-input"):null,$=w?w.querySelector("#profile-description-input"):null,P=x?x.querySelector("#card-image-input"):null,j=x?x.querySelector("#new-post-caption-input"):null,D=T?T.querySelector("#avatar-input"):null,B=document.querySelector(".profile__edit-btn"),N=document.querySelector(".profile__new-post-btn"),I=document.querySelector(".profile__avatar-edit-btn"),M=q?q.querySelector(".modal__image"):null,O=q?q.querySelector(".modal__caption"):null;let H=null,J=null,R=null;const z=new Map;function F(e){return z.has(e._id)?z.get(e._id):void 0!==e.likeCount?e.likeCount:void 0!==e.likesCount?e.likesCount:void 0!==e.like_count?e.like_count:0}function W(e){e&&(e.classList.add("modal_is-opened"),document.addEventListener("keydown",K),e.addEventListener("mousedown",Q))}function G(e){e&&(e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",K),e.removeEventListener("mousedown",Q))}function K(e){if("Escape"===e.key){const e=document.querySelector(".modal.modal_is-opened");e&&G(e)}}function Q(e){e.target.classList.contains("modal_is-opened")&&G(e.currentTarget)}function V(e){const t=y.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),o=t.querySelector(".card__like-btn"),l=t.querySelector(".card__like-count"),i=t.querySelector(".card__delete-btn");r.src=e.link,r.alt=e.name,n.textContent=e.name,l.textContent=String(F(e)),function(e){return!!H&&(void 0!==e.isLiked?e.isLiked:void 0!==e.liked?e.liked:void 0!==e.is_liked&&e.is_liked)}(e)?o.classList.add("card__like-btn_active"):o.classList.remove("card__like-btn_active"),o.addEventListener("click",()=>{const t=o.classList.contains("card__like-btn_active");(t?d.unlikeCard(e._id):d.likeCard(e._id)).then(r=>{const n=F(r),i=t?Math.max(0,n-1):n+1;z.set(e._id,i),o.classList.toggle("card__like-btn_active"),l.textContent=String(i),e.isLiked=!t}).catch(console.error)});let a=null;return"string"==typeof e.owner?a=e.owner:e.owner&&"object"==typeof e.owner&&(a=e.owner._id||e.owner.id||e.owner.userId),a===H?(i.style.display="block",i.addEventListener("click",()=>{J=t,R=e._id,W(h)})):i.style.display="none",r.addEventListener("click",()=>{M&&O&&(M.src=e.link,M.alt=e.name,O.textContent=e.name,W(q))}),t}var X;d.getAppData().then(([e,t])=>{H=e._id,m&&(m.textContent=e.name),_&&(_.textContent=e.about),p&&i(p,e.avatar),t.forEach(e=>{const t=e.isLiked?1:0;z.set(e._id,t)}),function(e){v&&(v.innerHTML="",e.forEach(e=>v.appendChild(V(e))))}(t)}).catch(console.error),B&&w&&U&&$&&(B.addEventListener("click",()=>{U.value=m?m.textContent:"",$.value=_?_.textContent:"",o(w,t),W(f)}),w.addEventListener("submit",e=>{s(function(){return d.updateUser({name:U.value,about:$.value}).then(e=>{m&&(m.textContent=e.name),_&&(_.textContent=e.about),G(f)})},e,"Saving...")})),N&&x&&j&&P&&(N.addEventListener("click",()=>{x.reset(),o(x,t),W(S)}),x.addEventListener("submit",e=>{s(function(){return d.addCard({name:j.value,link:P.value}).then(e=>{z.set(e._id,0),function(e){v&&v.prepend(V(e))}(e),x.reset(),o(x,t),G(S)})},e,"Saving...")})),A&&A.addEventListener("submit",e=>{s(function(){return R&&J?d.deleteCard(R).then(()=>{z.delete(R),J.remove(),J=null,R=null,G(h)}):Promise.resolve()},e,"Deleting...")}),I&&T&&D&&(I.addEventListener("click",()=>{T.reset(),o(T,t),W(b)}),T.addEventListener("submit",e=>{s(function(){return d.updateAvatar(D.value).then(e=>{p&&i(p,e.avatar),G(b)})},e,"Saving...")})),k&&k.addEventListener("click",()=>G(f)),g&&g.addEventListener("click",()=>G(S)),C&&C.addEventListener("click",()=>G(h)),E&&E.addEventListener("click",()=>G(b)),L&&L.addEventListener("click",()=>G(q)),X=t,Array.from(document.querySelectorAll(".modal__form")).forEach(e=>{const t=Array.from(e.querySelectorAll(X.inputSelector)),o=e.querySelector(X.submitButtonSelector);n(t,o,X),t.forEach(l=>{l.addEventListener("input",()=>{!function(e,t,n){t.validity.valid?r(e,t,n):function(e,t,r,n){const o=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),o&&(o.textContent=r,o.style.display="block")}(e,t,t.validationMessage,n)}(e,l,X),n(t,o,X)})}),e.addEventListener("submit",e=>{o.disabled&&e.preventDefault()})})})();