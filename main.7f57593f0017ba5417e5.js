(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(t=r.currentScript.src),!t)){var n=r.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=n[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t={inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn-disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};function r(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);r.forEach(r=>function(e,t,r){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),n&&(n.textContent="",n.style.display="none")}(e,r,t)),function(e,t,r){const n=e.some(e=>!e.validity.valid);t.disabled=n,t.classList.toggle(r.inactiveButtonClass,n)}(r,n,t)}const n=e.p+"assets/2fc47fd8e9a9bcd9612f.jpg";function o(e,t){if(!e)return;const r=new Image;r.onload=()=>{e.src=t},r.onerror=()=>{console.warn("Image URL failed to load, using fallback:",t),e.src=n},t&&"string"==typeof t&&t.startsWith("http")?r.src=t:e.src=n}const a=e.p+"assets/d3610e9c6dce3cb370d8.svg",l=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_check(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUser(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._check)}getCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._check)}getAppData(){return Promise.all([this.getUser(),this.getCards()])}updateUser({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._check)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._check)}addCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._check)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._check)}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._check)}unlikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._check)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"b5bb21ca-524c-4b9b-82e8-ef9e8c025693","Content-Type":"application/json"}}),s=document.querySelector(".header__logo"),i=document.querySelector(".profile__name"),c=document.querySelector(".profile__description"),d=document.querySelector(".profile__avatar");s&&(s.src=a),d&&(d.src=n);const u=document.querySelector(".cards__list"),_=document.querySelector("#card-template"),h=document.querySelector("#edit-profile-modal"),m=document.querySelector("#new-post-modal"),p=document.querySelector("#delete-modal"),b=document.querySelector("#avatar-modal"),y=document.querySelector("#preview-modal"),f=(h&&h.querySelector(".modal__close-btn"),m&&m.querySelector(".modal__close-btn"),p&&p.querySelector(".modal__close-btn"),b&&b.querySelector(".modal__close-btn"),y&&y.querySelector(".modal__close-btn"),h?h.querySelector(".modal__form"):null),v=m?m.querySelector(".modal__form"):null,S=p?p.querySelector(".modal__form"):null,k=b?b.querySelector(".modal__form"):null,C=f?f.querySelector("#profile-name-input"):null,g=f?f.querySelector("#profile-description-input"):null,q=v?v.querySelector("#card-image-input"):null,L=v?v.querySelector("#new-post-caption-input"):null,E=k?k.querySelector("#avatar-input"):null,w=document.querySelector(".profile__edit-btn"),x=document.querySelector(".profile__new-post-btn"),U=document.querySelector(".profile__avatar-edit-btn"),$=y?y.querySelector(".modal__image"):null,T=y?y.querySelector(".modal__caption"):null;let A=null,D=null,P=null;const j=new Map;function N(e){return j.has(e._id)?j.get(e._id):void 0!==e.likeCount?e.likeCount:void 0!==e.likesCount?e.likesCount:void 0!==e.like_count?e.like_count:0}function B(e){e&&(e.classList.add("modal_is-opened"),document.addEventListener("keydown",O),e.addEventListener("mousedown",H))}function I(e){e&&(e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",O),e.removeEventListener("mousedown",H))}function O(e){if("Escape"===e.key){const e=document.querySelector(".modal.modal_is-opened");e&&I(e)}}function H(e){e.target.classList.contains("modal_is-opened")&&I(e.currentTarget)}function J(e){const t=_.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__like-count"),s=t.querySelector(".card__delete-btn");r.src=e.link,r.alt=e.name,n.textContent=e.name,a.textContent=String(N(e)),function(e){return!!A&&(void 0!==e.isLiked?e.isLiked:void 0!==e.liked?e.liked:void 0!==e.is_liked&&e.is_liked)}(e)?o.classList.add("card__like-btn_active"):o.classList.remove("card__like-btn_active"),o.addEventListener("click",()=>{const t=o.classList.contains("card__like-btn_active");(t?l.unlikeCard(e._id):l.likeCard(e._id)).then(r=>{const n=N(r),l=t?Math.max(0,n-1):n+1;j.set(e._id,l),o.classList.toggle("card__like-btn_active"),a.textContent=String(l),e.isLiked=!t}).catch(e=>console.error(e))});let i=null;return"string"==typeof e.owner?i=e.owner:e.owner&&"object"==typeof e.owner&&(i=e.owner._id||e.owner.id||e.owner.userId),i===A?(s.style.display="block",s.addEventListener("click",()=>{D=t,P=e._id,B(p)})):s.style.display="none",r.addEventListener("click",()=>{$&&T&&($.src=e.link,$.alt=e.name,T.textContent=e.name,B(y))}),t}l.getAppData().then(([e,t])=>{A=e._id,i&&(i.textContent=e.name),c&&(c.textContent=e.about),d&&o(d,e.avatar),t.forEach(e=>{const t=e.isLiked?1:0;j.set(e._id,t)}),function(e){u&&(u.innerHTML="",e.forEach(e=>u.appendChild(J(e))))}(t)}).catch(e=>console.error(e)),w&&f&&C&&g&&(w.addEventListener("click",()=>{C.value=i?i.textContent:"",g.value=c?c.textContent:"",r(f,t),B(h)}),f.addEventListener("submit",e=>{e.preventDefault();const t=f.querySelector(".modal__submit-btn"),r=t.textContent;t.textContent="Saving...",t.disabled=!0,l.updateUser({name:C.value,about:g.value}).then(e=>{i&&(i.textContent=e.name),c&&(c.textContent=e.about),I(h)}).catch(e=>console.error(e)).finally(()=>{t.textContent=r,t.disabled=!1})})),x&&v&&L&&q&&(x.addEventListener("click",()=>{v.reset(),r(v,t),B(m)}),v.addEventListener("submit",e=>{e.preventDefault();const n=v.querySelector(".modal__submit-btn"),o=n.textContent;n.textContent="Saving...",n.disabled=!0,l.addCard({name:L.value,link:q.value}).then(e=>{j.set(e._id,0),function(e){u&&u.prepend(J(e))}(e),v.reset(),r(v,t),I(m)}).catch(e=>console.error(e)).finally(()=>{n.textContent=o,n.disabled=!1})})),S&&S.addEventListener("submit",e=>{if(e.preventDefault(),!P||!D)return;const t=S.querySelector(".modal__submit-btn"),r=t.textContent;t.textContent="Deleting...",t.disabled=!0,l.deleteCard(P).then(()=>{j.delete(P),D.remove(),D=null,P=null,I(p)}).catch(e=>console.error(e)).finally(()=>{t.textContent=r,t.disabled=!1})}),U&&k&&E&&(U.addEventListener("click",()=>{k.reset(),r(k,t),B(b)}),k.addEventListener("submit",e=>{e.preventDefault();const t=k.querySelector(".modal__submit-btn"),r=t.textContent;t.textContent="Saving...",t.disabled=!0,l.updateAvatar(E.value).then(e=>{d&&o(d,e.avatar),I(b)}).catch(e=>console.error(e)).finally(()=>{t.textContent=r,t.disabled=!1})}))})();